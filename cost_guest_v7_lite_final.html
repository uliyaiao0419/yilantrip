<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ—…è¡Œè²»ç”¨åˆ†æ”¤å™¨ v7-lite-finalï¼ˆå…å­˜æª”ï¼Œå®Œæ•´å¯ç”¨ï¼‰</title>
<style>
  :root{--bg:#fff8f5;--card:#ffffff;--text:#2b2b2b;--muted:#666;--accent:#ff7a59;--shadow:0 6px 18px rgba(0,0,0,.06);--radius:14px}
  body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Helvetica Neue",Arial,sans-serif}
  .container{max-width:980px;margin:0 auto;padding:12px}
  header{padding:16px;background:linear-gradient(135deg,#ffe4d8,#fff0c9 55%,#e6f7ff);border-bottom-left-radius:22px;border-bottom-right-radius:22px}
  h1{font-size:20px;margin:0 0 6px}.sub{color:#666;font-size:13px}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;margin-top:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input,select,button{font-size:14px;border:1px solid #ddd;border-radius:8px;padding:8px 10px;background:#fff}
  button{background:var(--accent);color:#fff;border:none;font-weight:600;box-shadow:var(--shadow);cursor:pointer}
  button.secondary{background:#fff;color:#333;border:1px solid #ccc}
  table{width:100%;border-collapse:collapse}th,td{padding:8px;border-bottom:1px solid #f0f0f0;text-align:left;font-size:13px}
  .pill{display:inline-block;border:1px dashed #ffd0c2;border-radius:999px;padding:4px 8px;font-size:12px}
  .muted{color:#777}
  .right{margin-left:auto}
  .badge{display:inline-block;padding:2px 6px;border-radius:999px;border:1px solid #eee;font-size:12px}
  .adult{background:#e8fff0}.elder{background:#ffeaea}.c7{background:#fff7d6}.c6{background:#eef5ff}
  .guest{background:#e9f6ff}.guest7{background:#f2f9ff}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal.active{display:flex}
  .modal-content{background:#fff;border-radius:14px;padding:16px;max-width:560px;width:92%;max-height:82%;overflow:auto}
  .chip{display:inline-block;background:#fff;border:1px solid #ddd;border-radius:999px;padding:4px 8px;font-size:12px;margin:2px;cursor:pointer}
  #msg{margin:8px 0;padding:6px 10px;background:#fff7e6;border:1px solid #ffcf99;border-radius:8px;color:#444;display:none}
</style>
</head>
<body>
<header class="card" style="margin-top:0">
  <div class="container">
    <h1>ğŸ’° æ—…è¡Œè²»ç”¨åˆ†æ”¤å™¨ v7-lite-final</h1>
    <div class="sub">æœ¬æª”ä¸ä½¿ç”¨ localStorageï¼Œç›´æ¥ file:// æ‰“é–‹å¯ç”¨ã€‚æˆäºº=1ã€7+å­©=0.5ã€&lt;7=0ï¼›é•·è¼©ä¸è‡ªä»˜â†’å·®é¡ç”±å®¶æ—(æˆäºº/7+)åˆ†æ”¤ï¼›å®¢äºº/å®¢äºº7+åªä»˜è‡ªå·±ï¼Œä¸åˆ†æ”¤é•·è¼©ã€‚</div>
  </div>
</header>

<main class="container">
  <div id="msg"></div>

  <section class="card">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ äººå“¡åå–®</h2>
    <div class="row">
      <input id="pName" placeholder="å§“å">
      <select id="pType">
        <option value="adult">æˆäºº</option><option value="elder">é•·è¼©</option>
        <option value="c7">å°å­©7+</option><option value="c6">å°å­©&lt;7</option>
        <option value="guest">å®¢äºº</option><option value="guest7">å®¢äººçš„å°å­©7+</option>
      </select>
      <button id="addBtn">æ–°å¢</button>
      <button class="secondary" id="demoBtn">ç¯„ä¾‹æ¸¬è©¦</button>
      <button class="secondary" id="resetBtn">å…¨éƒ¨æ¸…ç©º</button>
    </div>
    <table id="peopleTable"><thead><tr><th>å§“å</th><th>é¡åˆ¥</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </section>

  <section class="card">
    <h2>ğŸ§¾ ä»£å¢Š/èŠ±è²»</h2>
    <div class="row">
      <input id="eTitle" placeholder="é …ç›®">
      <input id="eAmount" placeholder="é‡‘é¡" inputmode="decimal">
      <select id="ePayer"></select>
      <button id="addExpenseBtn">æ–°å¢èŠ±è²»</button>
    </div>
    <div class="muted">å¯æŒ‰ã€Œé¸äººã€èª¿æ•´åƒèˆ‡è€…ï¼ˆæœ‰ã€Œå…¨é¸ / åƒ…é•·è¼© / å…¨ä¸é¸ã€ï¼‰ã€‚</div>
    <table id="expenseTable"><thead><tr><th>é …ç›®</th><th>é‡‘é¡</th><th>ä»˜æ¬¾è€…</th><th>åƒèˆ‡äºº</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </section>

  <section class="card">
    <h2>ğŸ“Š çµæœçµç®—</h2>
    <div class="row">
      <button id="calcBtn">é‡æ–°è¨ˆç®—</button>
      <button class="secondary" id="mergeBtn">åˆä½µè¨­å®šï¼ˆå§”è¨—ä»˜æ¬¾ï¼‰</button>
      <span class="pill right" id="weightInfo"></span>
    </div>
    <div class="card" style="margin-top:8px">
      <h3>ä»£å¢Šæ˜ç´°</h3>
      <table id="detailsTable"><thead><tr><th>é …ç›®</th><th>é‡‘é¡</th><th>ä»˜æ¬¾è€…</th><th>åƒèˆ‡äºº</th></tr></thead><tbody></tbody></table>
      <div class="muted" id="detailsEmpty" style="display:none">ç›®å‰æ²’æœ‰ä»»ä½•è²»ç”¨ï¼Œè«‹å…ˆæ–°å¢ã€‚</div>
    </div>
    <div class="card" style="margin-top:8px">
      <h3>å»ºè­°äº’ç›¸è½‰å¸³</h3>
      <table id="settleTable"><thead><tr><th>ç”±</th><th>è½‰çµ¦</th><th>é‡‘é¡</th></tr></thead><tbody></tbody></table>
      <div class="muted" id="settleEmpty" style="display:none">ç›®å‰ä¸éœ€è¦äº’ç›¸è½‰å¸³ã€‚</div>
    </div>
    <div class="card" style="margin-top:8px">
      <h3>æ¯äººæ¦‚æ³</h3>
      <table id="balanceTable"><thead><tr><th>å§“å</th><th>æ‡‰ä»˜</th><th>å·²ä»˜</th><th>å·®é¡</th></tr></thead><tbody></tbody></table>
    </div>
  </section>
</main>

<div class="modal" id="modal"><div class="modal-content" id="modalContent"></div></div>

<script>
// ====== State (in-memory only) ======
let people=[], expenses=[], mergeMap={};
const EPS=0.01;

// ====== Utils ======
const msgBox=document.getElementById('msg');
function showMsg(t){msgBox.textContent=t;msgBox.style.display='block';setTimeout(()=>msgBox.style.display='none',2200);}
function typeLabel(t){return {adult:"æˆäºº",elder:"é•·è¼©",c7:"å°å­©7+",c6:"å°å­©<7",guest:"å®¢äºº",guest7:"å®¢äººçš„å°å­©7+"}[t]||t;}
function badgeClass(t){return t;}
function baseWeight(type){ if(type==='adult'||type==='guest')return 1; if(type==='c7'||type==='guest7')return 0.5; return 0; }
function norm(s){return (s||'').trim().replace(/\s+/g,' ').toLowerCase();}

// ====== Modal helpers ======
const modal=document.getElementById('modal'), modalContent=document.getElementById('modalContent');
function showModal(html){modalContent.innerHTML=html;modal.classList.add('active');}
function closeModal(){modal.classList.remove('active');}
modal.addEventListener('click',e=>{if(e.target.id==='modal')closeModal();});

// ====== People ======
function renderPeople(){
  const tb=document.querySelector('#peopleTable tbody'); tb.innerHTML='';
  if(!people.length){const tr=document.createElement('tr');tr.innerHTML='<td colspan="3" class="muted">å°šç„¡æˆå“¡ï¼Œè«‹å…ˆæ–°å¢ã€‚</td>';tb.appendChild(tr);}
  people.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td><td><span class="badge ${badgeClass(p.type)}">${typeLabel(p.type)}</span></td>
      <td><button onclick="editPerson(${i})">ä¿®æ”¹</button> <button onclick="delPerson(${i})">åˆªé™¤</button></td>`;
    tb.appendChild(tr);
  });
  // payer select
  const sel=document.getElementById('ePayer'); sel.innerHTML='';
  people.forEach(p=>{const o=document.createElement('option');o.value=p.name;o.textContent=p.name;sel.appendChild(o)});
}
function addPerson(){
  const n=document.getElementById('pName').value.trim();
  const t=document.getElementById('pType').value;
  if(!n)return showMsg('âš ï¸ è«‹è¼¸å…¥å§“å');
  if(people.find(x=>norm(x.name)===norm(n)))return showMsg('âš ï¸ æ­¤å§“åå·²å­˜åœ¨');
  people.push({name:n,type:t});
  document.getElementById('pName').value='';
  renderPeople(); renderExpenses(); calc();
}
function editPerson(i){
  const p=people[i];
  showModal(`<h3>ä¿®æ”¹äººå“¡</h3>
    <div>å§“å<br><input id="epName" value="${p.name}" style="width:100%"></div>
    <div style="margin-top:6px">é¡åˆ¥<br>
      <select id="epType" style="width:100%">
        ${["adult","elder","c7","c6","guest","guest7"].map(t=>`<option value="${t}" ${p.type===t?'selected':''}>${typeLabel(t)}</option>`).join('')}
      </select>
    </div>
    <div style="text-align:right;margin-top:10px">
      <button class="secondary" onclick="closeModal()">å–æ¶ˆ</button>
      <button id="okBtn">å„²å­˜</button>
    </div>`);
  document.getElementById('okBtn').onclick=()=>{
    const nn=document.getElementById('epName').value.trim(); const nt=document.getElementById('epType').value;
    if(!nn){showMsg('âš ï¸ å§“åä¸å¯ç©ºç™½');return;}
    if(people.some((x,idx)=>idx!==i && norm(x.name)===norm(nn))){showMsg('âš ï¸ æ­¤å§“åå·²å­˜åœ¨');return;}
    const old=people[i].name;
    // åŒæ­¥æ‰€æœ‰è²»ç”¨ï¼ˆåƒèˆ‡è€…/ä»˜æ¬¾è€…åå­—ï¼‰
    expenses=expenses.map(e=>{
      const np=(e.participants||[]).map(n=>n===old?nn:n);
      const npayer=(e.payer===old)?nn:e.payer;
      return {...e,participants:np,payer:npayer};
    });
    people[i]={name:nn,type:nt};
    closeModal(); renderPeople(); renderExpenses(); calc(); showMsg('âœ… å·²æ›´æ–°äººå“¡');
  };
}
function delPerson(i){
  if(!confirm('ç¢ºå®šåˆªé™¤æ­¤æˆå“¡ï¼Ÿ'))return;
  const name=people[i].name;
  people.splice(i,1);
  expenses=expenses.map(e=>({...e,participants:(e.participants||[]).filter(n=>n!==name)}));
  renderPeople(); renderExpenses(); calc(); showMsg('ğŸ—‘ï¸ å·²åˆªé™¤æˆå“¡');
}

// ====== Expenses ======
function renderExpenses(){
  const tb=document.querySelector('#expenseTable tbody'); tb.innerHTML='';
  if(!expenses.length){const tr=document.createElement('tr');tr.innerHTML='<td colspan="5" class="muted">å°šç„¡è²»ç”¨ï¼Œè«‹æ–°å¢ã€‚</td>';tb.appendChild(tr);}
  expenses.forEach((e,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${e.title}</td><td>${e.amount}</td><td>${e.payer}</td><td>${(e.participants||[]).join(", ")}</td>
      <td><button onclick="editExpense(${i})">ä¿®æ”¹</button> <button onclick="editParticipants(${i})">é¸äºº</button> <button onclick="delExpense(${i})">åˆªé™¤</button></td>`;
    tb.appendChild(tr);
  });
  renderDetails();
}
function addExpense(){
  if(!people.length){showMsg('âš ï¸ è«‹å…ˆå»ºç«‹äººå“¡');return;}
  const t=(document.getElementById('eTitle').value||'æœªå‘½å').trim()||'æœªå‘½å';
  const a=parseFloat(document.getElementById('eAmount').value);
  const p=document.getElementById('ePayer').value;
  if(!isFinite(a)||a<=0){showMsg('âš ï¸ è«‹è¼¸å…¥æ­£ç¢ºé‡‘é¡');return;}
  if(!p){showMsg('âš ï¸ éœ€é¸æ“‡ä»˜æ¬¾è€…');return;}
  const parts=people.map(pp=>pp.name);
  expenses.push({title:t,amount:a,payer:p,participants:parts});
  document.getElementById('eTitle').value=''; document.getElementById('eAmount').value='';
  renderExpenses(); calc(); showMsg('âœ… å·²æ–°å¢è²»ç”¨');
}
function editExpense(i){
  const e=expenses[i];
  showModal(`<h3>ä¿®æ”¹è²»ç”¨</h3>
    <div>é …ç›®<br><input id="et" value="${e.title}" style="width:100%"></div>
    <div class="row" style="margin-top:6px">
      <label>é‡‘é¡ <input id="ea" value="${e.amount}" inputmode="decimal" style="width:120px"></label>
      <label>ä»˜æ¬¾è€… 
        <select id="epSel">${people.map(pp=>`<option ${pp.name===e.payer?'selected':''}>${pp.name}</option>`).join('')}</select>
      </label>
    </div>
    <div style="margin-top:10px;text-align:right">
      <button class="secondary" onclick="closeModal()">å–æ¶ˆ</button>
      <button id="okBtn">å„²å­˜</button>
    </div>`);
  document.getElementById('okBtn').onclick=()=>{
    const nt=(document.getElementById('et').value||'æœªå‘½å').trim();
    const na=parseFloat(document.getElementById('ea').value);
    const np=document.getElementById('epSel').value;
    if(!isFinite(na)||na<=0){showMsg('âš ï¸ é‡‘é¡ä¸æ­£ç¢º');return;}
    expenses[i]={...e,title:nt,amount:na,payer:np};
    closeModal(); renderExpenses(); calc(); showMsg('âœ… å·²æ›´æ–°è²»ç”¨');
  };
}
function delExpense(i){
  if(!confirm('ç¢ºå®šåˆªé™¤æ­¤è²»ç”¨ï¼Ÿ'))return;
  expenses.splice(i,1);
  renderExpenses(); calc(); showMsg('ğŸ—‘ï¸ å·²åˆªé™¤è²»ç”¨');
}
function editParticipants(i){
  const e=expenses[i];
  const checks=people.map(p=>`<label style="display:block;margin:4px 0">
    <input type="checkbox" value="${p.name}" ${e.participants.includes(p.name)?'checked':''}>
    ${p.name}ï¼ˆ${typeLabel(p.type)}ï¼‰
  </label>`).join('');
  showModal(`<h3>é¸æ“‡åƒèˆ‡è€…ï¼š${e.title}</h3>
    <div style="max-height:50vh;overflow:auto">${checks}</div>
    <div style="margin:8px 0">
      <span class="chip" id="allSel">å…¨é¸</span>
      <span class="chip" id="eldSel">åƒ…é•·è¼©</span>
      <span class="chip" id="noneSel">å…¨ä¸é¸</span>
    </div>
    <div style="text-align:right">
      <button class="secondary" onclick="closeModal()">å–æ¶ˆ</button>
      <button id="okBtn">å¥—ç”¨</button>
    </div>`);
  document.getElementById('allSel').onclick=()=>{document.querySelectorAll('#modal input[type=checkbox]').forEach(c=>c.checked=true)};
  document.getElementById('eldSel').onclick=()=>{document.querySelectorAll('#modal input[type=checkbox]').forEach(c=>{const n=c.value;const t=(people.find(p=>p.name===n)||{}).type; c.checked=(t==='elder');})};
  document.getElementById('noneSel').onclick=()=>{document.querySelectorAll('#modal input[type=checkbox]').forEach(c=>c.checked=false)};
  document.getElementById('okBtn').onclick=()=>{
    const sel=[...document.querySelectorAll('#modal input[type=checkbox]')].filter(c=>c.checked).map(c=>c.value);
    expenses[i].participants=sel; closeModal(); renderExpenses(); calc(); showMsg('âœ… å·²æ›´æ–°åƒèˆ‡è€…');
  };
}

// ====== Details ======
function renderDetails(){
  const tb=document.querySelector('#detailsTable tbody'); tb.innerHTML='';
  if(!expenses.length){document.getElementById('detailsEmpty').style.display='block'; return;}
  document.getElementById('detailsEmpty').style.display='none';
  expenses.forEach(e=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${e.title}</td><td>${e.amount}</td><td>${e.payer}</td><td>${(e.participants||[]).join(", ")}</td>`;
    tb.appendChild(tr);
  });
}

// ====== Merge (delegation) ======
function openMerge(){
  if(!people.length){showMsg('âš ï¸ è«‹å…ˆæ–°å¢æˆå“¡');return;}
  const opts=people.map(p=>`
    <label style="display:block;margin:6px 0">
      ${p.name} ç”±
      <select data-child="${p.name}">
        <option value="">è‡ªå·±</option>
        ${people.map(pp=>`<option value="${pp.name}" ${mergeMap[p.name]===pp.name?'selected':''}>${pp.name}</option>`).join('')}
      </select>
      ä»£ä»˜
    </label>`).join('');
  showModal(`<h3>åˆä½µè¨­å®šï¼ˆå§”è¨—ä»˜æ¬¾ï¼‰</h3>
    <div class="muted">è¢«å§”è¨—äººçš„å·®é¡æœƒä½µå…¥å§”è¨—è€…ï¼Œè½‰å¸³å»ºè­°åªåˆ—å§”è¨—è€…å‡ºé¢ã€‚</div>
    ${opts}
    <div style="text-align:right;margin-top:10px">
      <button class="secondary" onclick="closeModal()">å–æ¶ˆ</button>
      <button id="okBtn">å„²å­˜</button>
    </div>`);
  document.getElementById('okBtn').onclick=()=>{
    const map={}; document.querySelectorAll('#modal select').forEach(s=>{
      const child=s.getAttribute('data-child'); const parent=s.value||'';
      if(parent && child!==parent){ map[child]=parent; }
    });
    mergeMap=map; closeModal(); calc(); showMsg('âœ… å·²æ›´æ–°åˆä½µè¨­å®š');
  };
}

// ====== Calculation ======
// è¦å‰‡ï¼š
// - å®¢äºº/å®¢äºº7+ï¼šåªåˆ†è‡ªå·±çš„æ¬Šé‡ï¼Œä¸åˆ†æ”¤é•·è¼©ä»½
// - å®¶æ—(æˆäºº/7+)ï¼šåˆ†è‡ªå·± + é•·è¼©ä»½ï¼ˆæŒ‰å®¶æ—æ¬Šé‡æ¯”ä¾‹ï¼‰
// - é•·è¼©/å°å­©<7ï¼š0
function calc(){
  const names=[...new Set([...people.map(p=>p.name),...expenses.map(e=>e.payer)])].filter(Boolean);
  const paid=Object.fromEntries(names.map(n=>[n,0]));
  const owe=Object.fromEntries(names.map(n=>[n,0]));

  expenses.forEach(e=>{
    const part=(e.participants||[]).slice();
    const fam = part.filter(n=>['adult','c7'].includes((people.find(p=>p.name===n)||{}).type));
    const gst = part.filter(n=>['guest','guest7'].includes((people.find(p=>p.name===n)||{}).type));
    const eld = part.filter(n=>['elder'].includes((people.find(p=>p.name===n)||{}).type));

    const wFam = fam.reduce((s,n)=>s+baseWeight((people.find(p=>p.name===n)||{}).type),0);
    const wGst = gst.reduce((s,n)=>s+baseWeight((people.find(p=>p.name===n)||{}).type),0);
    const wEld = eld.length; // æ¯ä½é•·è¼©=1 å–®ä½æ¶ˆè²»ï¼ˆä¸è‡ªä»˜ï¼‰

    const denom = wFam + wGst + wEld;
    paid[e.payer]=(paid[e.payer]||0)+ (e.amount||0);
    if(denom<=EPS) return;

    const u = (e.amount||0)/denom;
    // è‡ªå·±çš„æ¶ˆè²»
    fam.forEach(n=>{const t=(people.find(p=>p.name===n)||{}).type; owe[n]+= u*baseWeight(t);});
    gst.forEach(n=>{const t=(people.find(p=>p.name===n)||{}).type; owe[n]+= u*baseWeight(t);});
    // é•·è¼©ä»½åªåŠ åˆ°å®¶æ—
    const elderAmt = u*wEld;
    if(wFam>EPS && elderAmt>EPS){
      fam.forEach(n=>{const t=(people.find(p=>p.name===n)||{}).type; const w=baseWeight(t); owe[n]+= elderAmt*(w/wFam);});
    }
  });

  // åˆä½µï¼ˆå§”è¨—ï¼‰ï¼šæŠŠ child çš„å·®é¡ä½µåˆ° parent
  let balances=Object.fromEntries(names.map(n=>[n,(paid[n]||0)-(owe[n]||0)]));
  Object.entries(mergeMap||{}).forEach(([child,parent])=>{
    if(child && parent && child!==parent){
      balances[parent]=(balances[parent]||0)+(balances[child]||0);
      balances[child]=0;
    }
  });

  // æ¯äººæ¦‚æ³
  const bt=document.querySelector('#balanceTable tbody'); bt.innerHTML='';
  names.forEach(n=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${n}</td><td>${Math.round(owe[n]||0)}</td><td>${Math.round(paid[n]||0)}</td><td>${Math.round((paid[n]||0)-(owe[n]||0))}</td>`;
    bt.appendChild(tr);
  });

  // è½‰å¸³å»ºè­°
  const creditors=Object.entries(balances).filter(([n,v])=> (v||0) > EPS).map(([n,v])=>({n,v})).sort((a,b)=>b.v-a.v);
  const debtors=Object.entries(balances).filter(([n,v])=> (v||0) < -EPS).map(([n,v])=>({n,-v})).sort((a,b)=>b.v-a.v);
  const st=document.querySelector('#settleTable tbody'); st.innerHTML='';
  if(creditors.length===0 && debtors.length===0){ document.getElementById('settleEmpty').style.display='block'; }
  else { document.getElementById('settleEmpty').style.display='none'; }
  let i=0,j=0;
  while(i<debtors.length && j<creditors.length){
    const d=debtors[i], c=creditors[j];
    const pay=Math.min(d.v,c.v);
    const tr=document.createElement('tr'); tr.innerHTML=`<td>${d.n}</td><td>${c.n}</td><td>${Math.round(pay)}</td>`; st.appendChild(tr);
    d.v-=pay; c.v-=pay;
    if(d.v<=EPS) i++; if(c.v<=EPS) j++;
  }

  // æ¬Šé‡æç¤º
  const totalW = people.reduce((s,p)=>s+baseWeight(p.type),0);
  document.getElementById('weightInfo').textContent = 'ç¸½æ¬Šé‡ï¼ˆä¸å«é•·è¼©ï¼‰ï¼š'+totalW;

  renderDetails();
}

// ====== Buttons ======
document.getElementById('addBtn').onclick=addPerson;
document.getElementById('addExpenseBtn').onclick=addExpense;
document.getElementById('calcBtn').onclick=calc;
document.getElementById('mergeBtn').onclick=openMerge;
document.getElementById('demoBtn').onclick=()=>{
  people=[
    {name:"A",type:"adult"},{name:"B",type:"adult"},{name:"C",type:"elder"},
    {name:"D",type:"guest"},{name:"E",type:"guest7"}
  ];
  expenses=[
    {title:"æ™šé¤",amount:3000,payer:"A",participants:["A","B","C","D","E"]},
    {title:"æ—©é¤",amount:600,payer:"D",participants:["D","E"]},
    {title:"é•·è¼©é†«ç™‚è²»",amount:2000,payer:"B",participants:["C"]}
  ];
  mergeMap={};
  renderPeople(); renderExpenses(); calc(); showMsg('âœ… å·²è¼‰å…¥ç¯„ä¾‹è³‡æ–™');
};
document.getElementById('resetBtn').onclick=()=>{
  if(!confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿ'))return;
  people=[]; expenses=[]; mergeMap={};
  renderPeople(); renderExpenses(); calc(); showMsg('ğŸ§¹ å·²å…¨éƒ¨æ¸…ç©º');
};

// ====== Init ======
renderPeople(); renderExpenses(); calc(); showMsg('âœ… è¼‰å…¥å®Œæˆï¼Œå¯é–‹å§‹æ“ä½œ');
</script>
</body>
</html>
